import { Component, EventEmitter, Input, Output } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "../../services/reporter.service";
import * as i2 from "@cima/commons";
import * as i3 from "@angular/material/slide-toggle";
import * as i4 from "@angular/material/form-field";
import * as i5 from "../print-layout/print-layout.component";
import * as i6 from "@angular/material/select";
import * as i7 from "@angular/material/core";
import * as i8 from "@angular/material/button";
import * as i9 from "../img-uploader/img-uploader.component";
import * as i10 from "@angular/forms";
import * as i11 from "@angular/common";
import * as i12 from "@angular/material/input";
export class ExpectedSituationComponent {
    constructor(reporterService, snackBar) {
        this.reporterService = reporterService;
        this.snackBar = snackBar;
        this.forecastReportChange = new EventEmitter();
        this.sectionEnabled = false;
        this.textExpected = '<span>Situazione prevista...</span>';
        this.config = { height: '200px', placeholder: 'Situazione prevista...' };
        this.rainMapDatas = [];
        this.snowMapDatas = [];
        this.geoMapDatas = [];
        this.uploadedImageLayers = [];
        /*PREC RUN*/
        this.runsPrec = [
            {
                id: 0,
                run: ''
            }
        ];
        /*SNOW RUN*/
        this.runsSnow = [
            {
                id: 0,
                run: ''
            }
        ];
        /*GEOPOT RUN*/
        this.runsGeoPot = [
            {
                id: 0,
                run: ''
            }
        ];
    }
    addRunPrec() {
        this.runsPrec = [...this.runsPrec, { id: 1, run: '' }];
    }
    delRunPrec(item) {
        this.runsPrec = this.runsPrec.filter((x) => x != item);
    }
    addRunSnow() {
        this.runsSnow = [...this.runsSnow, { id: 1, run: '' }];
    }
    delRunSnow(item) {
        this.runsSnow = this.runsSnow.filter((x) => x != item);
    }
    addRunGeoPot() {
        this.runsGeoPot = [...this.runsGeoPot, { id: 1, run: '' }];
    }
    delRunGeoPot(item) {
        this.runsGeoPot =
            this.runsGeoPot.filter((x) => x != item);
    }
    uploadedImageChange(event) {
        console.log(event);
        this.uploadedImageLayers = event;
        this.updateLayers();
    }
    updateLayers() {
        this.forecastReport.layers = [];
        this.runsPrec.forEach(itm => { if (itm.data)
            this.forecastReport.layers.push(itm.data); });
        this.runsSnow.forEach(itm => { if (itm.data)
            this.forecastReport.layers.push(itm.data); });
        this.runsGeoPot.forEach(itm => { if (itm.data)
            this.forecastReport.layers.push(itm.data); });
        this.uploadedImageLayers.forEach(itm => this.forecastReport.layers.push(itm));
        console.log('layers', this.forecastReport.layers);
    }
    dateUpdate() {
        if (this.dateFrom)
            this.forecastReport.fromUTCSecond = Math.trunc(new Date(this.dateFrom).getTime() / 1000);
        if (this.dateTo)
            this.forecastReport.toUTCSecond = Math.trunc(new Date(this.dateTo).getTime() / 1000);
        //this.loadStations();
        this.loadForecastDatasAvailability();
    }
    layoutChange(layout) {
        if (this.forecastReport)
            this.forecastReport.nImgs = layout.numberOfImages;
        console.log('report', this.forecastReport);
    }
    selectMap(type, event, prec) {
        console.log('selected', event, prec);
        //TODO
        this.reporterService.getForecastData(type, event).subscribe(data => {
            console.log(data);
            prec.data = data;
            this.updateLayers();
        }, error => {
            console.error(error);
            this.snackBar.error("Errore durante il caricamento della mappa di previsione.", '', { duration: 2000 });
        });
    }
    loadAvailability(dataType, listData) {
        listData.splice(0, listData.length);
        this.reporterService.getForecastDatasAvailability(dataType, this.forecastReport.fromUTCSecond, this.forecastReport.toUTCSecond).subscribe(data => {
            listData.push(...data.runs);
        }, error => {
            console.error(error);
            this.snackBar.error('Si è verificato un errore durante la lettura dei dati.', '', { duration: 2000 });
        });
    }
    loadForecastDatasAvailability() {
        //todo cancellare vecchi layers
        if (this.forecastReport.fromUTCSecond > 0 && this.forecastReport.toUTCSecond > 0) {
            this.loadAvailability('ITALIA_PT', this.rainMapDatas);
            this.loadAvailability('ITALIA_NT', this.snowMapDatas);
            this.loadAvailability('EURATL_GGTT', this.geoMapDatas);
        }
    }
    enableReport() {
        if (this.sectionEnabled) {
            this.forecastReport = {
                fromUTCSecond: 0,
                toUTCSecond: 0,
                text: '',
                title: '',
                nImgs: 1,
                raings_title: 'Pluviometri',
                hydros_title: 'Idrometri',
                layers: [], //todo
            };
            this.updateLayers();
            this.dateUpdate();
            this.forecastReportChange.emit(this.forecastReport);
        }
        else {
            this.forecastReport = undefined;
        }
    }
    ngOnInit() {
        this.enableReport();
    }
}
ExpectedSituationComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.11", ngImport: i0, type: ExpectedSituationComponent, deps: [{ token: i1.ReporterService }, { token: i2.SnackbarService }], target: i0.ɵɵFactoryTarget.Component });
ExpectedSituationComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.11", type: ExpectedSituationComponent, selector: "reporter-expected-situation", inputs: { forecastReport: "forecastReport" }, outputs: { forecastReportChange: "forecastReportChange" }, ngImport: i0, template: "<!--abilitazione-->\n<mat-slide-toggle\n  class=\"\"\n  color=primary [(ngModel)]=\"sectionEnabled\" (change)=\"enableReport()\">\n  Includi Situazione Prevista\n</mat-slide-toggle>\n\n\n<div class=\"section-wrapper\" [ngClass]=\"!sectionEnabled?'section-disabled':''\">\n  <!--mappa-->\n  <div class=\"col-12 my-2\">\n    <!--periodo di analisi-->\n    <h2 class=\"border-bottom mb-3 mt-3\">Periodo di Analisi</h2>\n\n    <mat-form-field appearance=\"fill\" class=\"me-2\">\n      <mat-label>da</mat-label>\n      <input matInput type=\"datetime-local\" placeholder=\"data da\" [(ngModel)]= \"dateFrom\" (change)=\"dateUpdate()\">\n    </mat-form-field>\n\n    <mat-form-field appearance=\"fill\" class=\"me-2\">\n      <mat-label>a</mat-label>\n      <input matInput type=\"datetime-local\" placeholder=\"data a\" [(ngModel)]= \"dateTo\" (change)=\"dateUpdate()\">\n    </mat-form-field>\n\n    <!-- <button mat-flat-button color=\"primary\"><span class=\"fas fa-clock me-1\"></span>Now</button> -->\n\n  </div>\n\n  <!--testo situazione pregressa-->\n  <div class=\"col-12 my-2\">\n    <cima-text-editor [(text)]=\"textExpected\" [config]=\"config\"></cima-text-editor>\n  </div>\n\n  <!--layout stampa-->\n  <div class=\"col-12 my-2\">\n    <reporter-print-layout  (selected)=\"layoutChange($event)\"></reporter-print-layout>\n  </div>\n\n  <!--layer-->\n  <div class=\"col-12 my-2\">\n    <h2 class=\"border-bottom mb-3 mt-3\">Layers</h2>\n    <div class=\"row\">\n\n      <!--PRECIPITAZIONI-->\n      <div class=\"col-12 col-lg-6 col-xl-3 mb-2\">\n        <div class=\"col-wrapper p-3\">\n          <h3>Previsione Precipitazione cum. 6h</h3>\n          <div class=\"runPrec\" *ngFor=\"let prec of runsPrec, let i = index\">\n\n            <div class=\"item-list-big-bull bg-secondary\">\n              <span>{{i+1}}</span>\n            </div>\n\n            <mat-form-field appearance=\"fill\" class=\"w-100\">\n              <mat-label>Seleziona run</mat-label>\n              <mat-select (valueChange)=\"selectMap('ITALIA_PT',$event, prec)\">\n                <mat-option *ngFor=\"let run of rainMapDatas\"  [value]=\"run\">\n                  {{run.descr}}\n                </mat-option>\n              </mat-select>\n            </mat-form-field>\n\n            <div class=\"del-btn-wrapper ms-2\">\n              <span class=\"del-btn fas fa-trash-alt\" *ngIf=\"i>0\" (click)=\"delRunPrec(prec)\"></span>\n            </div>\n\n          </div>\n\n          <button mat-flat-button color=\"primary\" class=\"bg-success\" (click)=\"addRunPrec()\"><span class=\"fas fa-plus me-1\"></span>Aggiungi Run Precipitazioni</button>\n\n        </div>\n      </div>\n\n      <!--NEVE-->\n      <div class=\"col-12 col-lg-6 col-xl-3 mb-2\">\n        <div class=\"col-wrapper p-3\">\n          <h3>Previsione Neve cum. 6h</h3>\n          <div class=\"runPrec\" *ngFor=\"let snow of runsSnow, let i = index\">\n\n            <div class=\"item-list-big-bull bg-secondary\">\n              <span>{{i+1}}</span>\n            </div>\n\n            <mat-form-field appearance=\"fill\" class=\"w-100\">\n              <mat-label>Seleziona run</mat-label>\n              <mat-select (valueChange)=\"selectMap('ITALIA_NT',$event, snow)\">\n                <mat-option *ngFor=\"let run of snowMapDatas\" [value]=\"run\">\n                  {{run.descr}}\n                </mat-option>\n              </mat-select>\n            </mat-form-field>\n\n            <div class=\"del-btn-wrapper ms-2\">\n              <span class=\"del-btn fas fa-trash-alt\" *ngIf=\"i>0\" (click)=\"delRunSnow(snow)\"></span>\n            </div>\n\n          </div>\n\n          <button mat-flat-button color=\"primary\" class=\"bg-success\" (click)=\"addRunSnow()\"><span class=\"fas fa-plus me-1\"></span>Aggiungi Run Neve</button>\n\n        </div>\n      </div>\n\n      <!--GEOPOTENZIALI-->\n      <div class=\"col-12 col-lg-6 col-xl-3 mb-2\">\n        <div class=\"col-wrapper p-3\">\n          <h3>Previsione Geopotenziale cum. 6h  (500hpa)</h3>\n          <div class=\"runPrec\" *ngFor=\"let geo of runsGeoPot, let i = index\">\n\n            <div class=\"item-list-big-bull bg-secondary\">\n              <span>{{i+1}}</span>\n            </div>\n\n            <mat-form-field appearance=\"fill\" class=\"w-100\">\n              <mat-label>Seleziona run</mat-label>\n              <mat-select (valueChange)=\"selectMap('EURATL_GGTT',$event, geo)\">\n                <mat-option *ngFor=\"let run of geoMapDatas\" [value]=\"run\">\n                  {{run.descr}}\n                </mat-option>\n              </mat-select>\n            </mat-form-field>\n\n            <div class=\"del-btn-wrapper ms-2\">\n              <span class=\"del-btn fas fa-trash-alt\" *ngIf=\"i>0\" (click)=\"delRunGeoPot(geo)\"></span>\n            </div>\n\n          </div>\n\n          <button mat-flat-button color=\"primary\" class=\"bg-success\" (click)=\"addRunGeoPot()\"><span class=\"fas fa-plus me-1\"></span>Aggiungi Run Geopotenziale</button>\n\n        </div>\n      </div>\n\n      <div class=\"col-12 col-lg-6 col-xl-3 mb-2\">\n        <div class=\"col-wrapper p-3\">\n          <reporter-img-uploader (uploadedChange)=\"uploadedImageChange($event)\"></reporter-img-uploader>\n        </div>\n      </div>\n\n    </div>\n  </div>\n\n</div>\n", styles: [".section-disabled{opacity:.3;pointer-events:none}.col-wrapper{background-color:#f5f5f5;border-radius:4px}:host ::ng-deep .col-wrapper .mat-form-field-infix{width:auto!important}.runPrec{display:flex}.item-list-big-bull{min-width:25px;min-height:25px;max-width:25px;max-height:25px;border-radius:50%;background-color:#0266cc;color:#fff;display:flex;justify-content:center;align-items:center;font-size:1.2em;font-weight:600;margin-right:8px;margin-top:14px}.del-btn-wrapper{padding-top:16px;width:25px}.del-btn-wrapper .del-btn{cursor:pointer;color:gray}.del-btn-wrapper .del-btn:hover{color:#2f4f4f}\n"], components: [{ type: i3.MatSlideToggle, selector: "mat-slide-toggle", inputs: ["disabled", "disableRipple", "color", "tabIndex", "name", "id", "labelPosition", "aria-label", "aria-labelledby", "aria-describedby", "required", "checked"], outputs: ["change", "toggleChange"], exportAs: ["matSlideToggle"] }, { type: i4.MatFormField, selector: "mat-form-field", inputs: ["color", "appearance", "hideRequiredMarker", "hintLabel", "floatLabel"], exportAs: ["matFormField"] }, { type: i2.TextEditorComponent, selector: "cima-text-editor", inputs: ["validator", "text", "config"], outputs: ["textChange"] }, { type: i5.PrintLayoutComponent, selector: "reporter-print-layout", outputs: ["selected"] }, { type: i6.MatSelect, selector: "mat-select", inputs: ["disabled", "disableRipple", "tabIndex"], exportAs: ["matSelect"] }, { type: i7.MatOption, selector: "mat-option", exportAs: ["matOption"] }, { type: i8.MatButton, selector: "button[mat-button], button[mat-raised-button], button[mat-icon-button],             button[mat-fab], button[mat-mini-fab], button[mat-stroked-button],             button[mat-flat-button]", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { type: i9.ImgUploaderComponent, selector: "reporter-img-uploader", outputs: ["uploadedChange"] }], directives: [{ type: i10.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i10.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { type: i11.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i4.MatLabel, selector: "mat-label" }, { type: i12.MatInput, selector: "input[matInput], textarea[matInput], select[matNativeControl],      input[matNativeControl], textarea[matNativeControl]", inputs: ["disabled", "id", "placeholder", "name", "required", "type", "errorStateMatcher", "aria-describedby", "value", "readonly"], exportAs: ["matInput"] }, { type: i10.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { type: i11.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i11.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.11", ngImport: i0, type: ExpectedSituationComponent, decorators: [{
            type: Component,
            args: [{ selector: 'reporter-expected-situation', template: "<!--abilitazione-->\n<mat-slide-toggle\n  class=\"\"\n  color=primary [(ngModel)]=\"sectionEnabled\" (change)=\"enableReport()\">\n  Includi Situazione Prevista\n</mat-slide-toggle>\n\n\n<div class=\"section-wrapper\" [ngClass]=\"!sectionEnabled?'section-disabled':''\">\n  <!--mappa-->\n  <div class=\"col-12 my-2\">\n    <!--periodo di analisi-->\n    <h2 class=\"border-bottom mb-3 mt-3\">Periodo di Analisi</h2>\n\n    <mat-form-field appearance=\"fill\" class=\"me-2\">\n      <mat-label>da</mat-label>\n      <input matInput type=\"datetime-local\" placeholder=\"data da\" [(ngModel)]= \"dateFrom\" (change)=\"dateUpdate()\">\n    </mat-form-field>\n\n    <mat-form-field appearance=\"fill\" class=\"me-2\">\n      <mat-label>a</mat-label>\n      <input matInput type=\"datetime-local\" placeholder=\"data a\" [(ngModel)]= \"dateTo\" (change)=\"dateUpdate()\">\n    </mat-form-field>\n\n    <!-- <button mat-flat-button color=\"primary\"><span class=\"fas fa-clock me-1\"></span>Now</button> -->\n\n  </div>\n\n  <!--testo situazione pregressa-->\n  <div class=\"col-12 my-2\">\n    <cima-text-editor [(text)]=\"textExpected\" [config]=\"config\"></cima-text-editor>\n  </div>\n\n  <!--layout stampa-->\n  <div class=\"col-12 my-2\">\n    <reporter-print-layout  (selected)=\"layoutChange($event)\"></reporter-print-layout>\n  </div>\n\n  <!--layer-->\n  <div class=\"col-12 my-2\">\n    <h2 class=\"border-bottom mb-3 mt-3\">Layers</h2>\n    <div class=\"row\">\n\n      <!--PRECIPITAZIONI-->\n      <div class=\"col-12 col-lg-6 col-xl-3 mb-2\">\n        <div class=\"col-wrapper p-3\">\n          <h3>Previsione Precipitazione cum. 6h</h3>\n          <div class=\"runPrec\" *ngFor=\"let prec of runsPrec, let i = index\">\n\n            <div class=\"item-list-big-bull bg-secondary\">\n              <span>{{i+1}}</span>\n            </div>\n\n            <mat-form-field appearance=\"fill\" class=\"w-100\">\n              <mat-label>Seleziona run</mat-label>\n              <mat-select (valueChange)=\"selectMap('ITALIA_PT',$event, prec)\">\n                <mat-option *ngFor=\"let run of rainMapDatas\"  [value]=\"run\">\n                  {{run.descr}}\n                </mat-option>\n              </mat-select>\n            </mat-form-field>\n\n            <div class=\"del-btn-wrapper ms-2\">\n              <span class=\"del-btn fas fa-trash-alt\" *ngIf=\"i>0\" (click)=\"delRunPrec(prec)\"></span>\n            </div>\n\n          </div>\n\n          <button mat-flat-button color=\"primary\" class=\"bg-success\" (click)=\"addRunPrec()\"><span class=\"fas fa-plus me-1\"></span>Aggiungi Run Precipitazioni</button>\n\n        </div>\n      </div>\n\n      <!--NEVE-->\n      <div class=\"col-12 col-lg-6 col-xl-3 mb-2\">\n        <div class=\"col-wrapper p-3\">\n          <h3>Previsione Neve cum. 6h</h3>\n          <div class=\"runPrec\" *ngFor=\"let snow of runsSnow, let i = index\">\n\n            <div class=\"item-list-big-bull bg-secondary\">\n              <span>{{i+1}}</span>\n            </div>\n\n            <mat-form-field appearance=\"fill\" class=\"w-100\">\n              <mat-label>Seleziona run</mat-label>\n              <mat-select (valueChange)=\"selectMap('ITALIA_NT',$event, snow)\">\n                <mat-option *ngFor=\"let run of snowMapDatas\" [value]=\"run\">\n                  {{run.descr}}\n                </mat-option>\n              </mat-select>\n            </mat-form-field>\n\n            <div class=\"del-btn-wrapper ms-2\">\n              <span class=\"del-btn fas fa-trash-alt\" *ngIf=\"i>0\" (click)=\"delRunSnow(snow)\"></span>\n            </div>\n\n          </div>\n\n          <button mat-flat-button color=\"primary\" class=\"bg-success\" (click)=\"addRunSnow()\"><span class=\"fas fa-plus me-1\"></span>Aggiungi Run Neve</button>\n\n        </div>\n      </div>\n\n      <!--GEOPOTENZIALI-->\n      <div class=\"col-12 col-lg-6 col-xl-3 mb-2\">\n        <div class=\"col-wrapper p-3\">\n          <h3>Previsione Geopotenziale cum. 6h  (500hpa)</h3>\n          <div class=\"runPrec\" *ngFor=\"let geo of runsGeoPot, let i = index\">\n\n            <div class=\"item-list-big-bull bg-secondary\">\n              <span>{{i+1}}</span>\n            </div>\n\n            <mat-form-field appearance=\"fill\" class=\"w-100\">\n              <mat-label>Seleziona run</mat-label>\n              <mat-select (valueChange)=\"selectMap('EURATL_GGTT',$event, geo)\">\n                <mat-option *ngFor=\"let run of geoMapDatas\" [value]=\"run\">\n                  {{run.descr}}\n                </mat-option>\n              </mat-select>\n            </mat-form-field>\n\n            <div class=\"del-btn-wrapper ms-2\">\n              <span class=\"del-btn fas fa-trash-alt\" *ngIf=\"i>0\" (click)=\"delRunGeoPot(geo)\"></span>\n            </div>\n\n          </div>\n\n          <button mat-flat-button color=\"primary\" class=\"bg-success\" (click)=\"addRunGeoPot()\"><span class=\"fas fa-plus me-1\"></span>Aggiungi Run Geopotenziale</button>\n\n        </div>\n      </div>\n\n      <div class=\"col-12 col-lg-6 col-xl-3 mb-2\">\n        <div class=\"col-wrapper p-3\">\n          <reporter-img-uploader (uploadedChange)=\"uploadedImageChange($event)\"></reporter-img-uploader>\n        </div>\n      </div>\n\n    </div>\n  </div>\n\n</div>\n", styles: [".section-disabled{opacity:.3;pointer-events:none}.col-wrapper{background-color:#f5f5f5;border-radius:4px}:host ::ng-deep .col-wrapper .mat-form-field-infix{width:auto!important}.runPrec{display:flex}.item-list-big-bull{min-width:25px;min-height:25px;max-width:25px;max-height:25px;border-radius:50%;background-color:#0266cc;color:#fff;display:flex;justify-content:center;align-items:center;font-size:1.2em;font-weight:600;margin-right:8px;margin-top:14px}.del-btn-wrapper{padding-top:16px;width:25px}.del-btn-wrapper .del-btn{cursor:pointer;color:gray}.del-btn-wrapper .del-btn:hover{color:#2f4f4f}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ReporterService }, { type: i2.SnackbarService }]; }, propDecorators: { forecastReport: [{
                type: Input
            }], forecastReportChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwZWN0ZWQtc2l0dWF0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NpbWEvcmVwb3J0ZXIvc3JjL2xpYi9jb21wb25lbnRzL2V4cGVjdGVkLXNpdHVhdGlvbi9leHBlY3RlZC1zaXR1YXRpb24uY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvY2ltYS9yZXBvcnRlci9zcmMvbGliL2NvbXBvbmVudHMvZXhwZWN0ZWQtc2l0dWF0aW9uL2V4cGVjdGVkLXNpdHVhdGlvbi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7Ozs7Ozs7Ozs7OztBQWEvRSxNQUFNLE9BQU8sMEJBQTBCO0lBeUNyQyxZQUFvQixlQUFnQyxFQUFVLFFBQXlCO1FBQW5FLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUFVLGFBQVEsR0FBUixRQUFRLENBQWlCO1FBdkM3RSx5QkFBb0IsR0FBRyxJQUFJLFlBQVksRUFBa0IsQ0FBQztRQUU3RCxtQkFBYyxHQUFDLEtBQUssQ0FBQTtRQUdwQixpQkFBWSxHQUFXLHFDQUFxQyxDQUFDO1FBQzdELFdBQU0sR0FBOEIsRUFBQyxNQUFNLEVBQUMsT0FBTyxFQUFFLFdBQVcsRUFBRSx3QkFBd0IsRUFBQyxDQUFBO1FBRzNGLGlCQUFZLEdBQVEsRUFBRSxDQUFDO1FBQ3ZCLGlCQUFZLEdBQVEsRUFBRSxDQUFDO1FBQ3ZCLGdCQUFXLEdBQVEsRUFBRSxDQUFDO1FBQ3RCLHdCQUFtQixHQUFRLEVBQUUsQ0FBQztRQUtyQyxZQUFZO1FBQ0wsYUFBUSxHQUFVO1lBQ3ZCO2dCQUNFLEVBQUUsRUFBQyxDQUFDO2dCQUNKLEdBQUcsRUFBQyxFQUFFO2FBQ1A7U0FDRixDQUFBO1FBQ0QsWUFB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QUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNyRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxFQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUN6RDtJQUNILENBQUM7SUFFTSxZQUFZO1FBQ2pCLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBQztZQUN0QixJQUFJLENBQUMsY0FBYyxHQUFDO2dCQUNsQixhQUFhLEVBQUUsQ0FBQztnQkFDaEIsV0FBVyxFQUFFLENBQUM7Z0JBQ2QsSUFBSSxFQUFFLEVBQUU7Z0JBQ1IsS0FBSyxFQUFFLEVBQUU7Z0JBQ1QsS0FBSyxFQUFFLENBQUM7Z0JBQ1IsWUFBWSxFQUFFLGFBQWE7Z0JBQzNCLFlBQVksRUFBRSxXQUFXO2dCQUN6QixNQUFNLEVBQUUsRUFBRSxFQUFFLE1BQU07YUFDbkIsQ0FBQTtZQUNELElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNwQixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDbEIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7U0FDckQ7YUFBTTtZQUNMLElBQUksQ0FBQyxjQUFjLEdBQUMsU0FBUyxDQUFDO1NBQy9CO0lBQ0gsQ0FBQztJQUVELFFBQVE7UUFDSixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDeEIsQ0FBQzs7d0hBaktVLDBCQUEwQjs0R0FBMUIsMEJBQTBCLDRLQ2J2Qyw4cktBK0lBOzRGRGxJYSwwQkFBMEI7a0JBTHRDLFNBQVM7K0JBQ0UsNkJBQTZCO29JQUs5QixjQUFjO3NCQUF0QixLQUFLO2dCQUNJLG9CQUFvQjtzQkFBN0IsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7U25hY2tiYXJTZXJ2aWNlLCBUZXh0RWRpdG9yQ29tcG9uZW50Q29uZmlnfSBmcm9tIFwiQGNpbWEvY29tbW9uc1wiO1xuaW1wb3J0IHsgdGhyb3dJZkVtcHR5IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUHJpbnRMYXlvdXQgfSBmcm9tICcuLi8uLi9tb2RlbHMvY2xhc3Nlcyc7XG5pbXBvcnQgeyBGb3JlY2FzdFJlcG9ydCB9IGZyb20gJy4uLy4uL21vZGVscy9pbnRlcmZhY2VzJztcbmltcG9ydCB7RmFrZURhdGFTZXJ2aWNlfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvZmFrZS1kYXRhLnNlcnZpY2VcIjtcbmltcG9ydCB7IFJlcG9ydGVyU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3JlcG9ydGVyLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdyZXBvcnRlci1leHBlY3RlZC1zaXR1YXRpb24nLFxuICB0ZW1wbGF0ZVVybDogJy4vZXhwZWN0ZWQtc2l0dWF0aW9uLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZXhwZWN0ZWQtc2l0dWF0aW9uLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgRXhwZWN0ZWRTaXR1YXRpb25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBASW5wdXQoKSBmb3JlY2FzdFJlcG9ydDogRm9yZWNhc3RSZXBvcnQ7XG4gIEBPdXRwdXQoKSBmb3JlY2FzdFJlcG9ydENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8Rm9yZWNhc3RSZXBvcnQ+KCk7XG5cbiAgcHVibGljIHNlY3Rpb25FbmFibGVkPWZhbHNlXG5cblxuICBwdWJsaWMgdGV4dEV4cGVjdGVkOiBzdHJpbmcgPSAnPHNwYW4+U2l0dWF6aW9uZSBwcmV2aXN0YS4uLjwvc3Bhbj4nO1xuICBwdWJsaWMgY29uZmlnOiBUZXh0RWRpdG9yQ29tcG9uZW50Q29uZmlnID0ge2hlaWdodDonMjAwcHgnLCBwbGFjZWhvbGRlcjogJ1NpdHVhemlvbmUgcHJldmlzdGEuLi4nfVxuICBwdWJsaWMgZGF0ZUZyb206IGFueTtcbiAgcHVibGljIGRhdGVUbzogYW55O1xuICBwdWJsaWMgcmFpbk1hcERhdGFzOiBhbnlbXT1bXTtcbiAgcHVibGljIHNub3dNYXBEYXRhczogYW55W109W107XG4gIHB1YmxpYyBnZW9NYXBEYXRhczogYW55W109W107XG4gIHB1YmxpYyB1cGxvYWRlZEltYWdlTGF5ZXJzOiBhbnlbXT1bXTtcblxuXG5cblxuICAvKlBSRUMgUlVOKi9cbiAgcHVibGljIHJ1bnNQcmVjOiBhbnlbXSA9IFtcbiAgICB7XG4gICAgICBpZDowLFxuICAgICAgcnVuOicnXG4gICAgfVxuICBdXG4gIC8qU05PVyBSVU4qL1xuICBwdWJsaWMgcnVuc1Nub3c6IGFueVtdID0gW1xuICAgIHtcbiAgICAgIGlkOjAsXG4gICAgICBydW46JydcbiAgICB9XG4gIF1cbiAgICAvKkdFT1BPVCBSVU4qL1xuICAgIHB1YmxpYyBydW5zR2VvUG90OiBhbnlbXSA9IFtcbiAgICAgIHtcbiAgICAgICAgaWQ6MCxcbiAgICAgICAgcnVuOicnXG4gICAgICB9XG4gICAgXVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVwb3J0ZXJTZXJ2aWNlOiBSZXBvcnRlclNlcnZpY2UsIHByaXZhdGUgc25hY2tCYXI6IFNuYWNrYmFyU2VydmljZSkgeyB9XG5cblxuICBhZGRSdW5QcmVjKCl7XG4gICAgdGhpcy5ydW5zUHJlYyA9IFsuLi50aGlzLnJ1bnNQcmVjLCB7aWQ6MSwgcnVuOicnfV1cbiAgfVxuICBkZWxSdW5QcmVjKGl0ZW06YW55KSB7XG4gICAgdGhpcy5ydW5zUHJlYyA9IHRoaXMucnVuc1ByZWMuZmlsdGVyKCh4OiBhbnkpID0+IHggIT0gaXRlbSlcbiAgfVxuXG5cbiAgYWRkUnVuU25vdygpe1xuICAgIHRoaXMucnVuc1Nub3cgPSBbLi4udGhpcy5ydW5zU25vdywge2lkOjEsIHJ1bjonJ31dXG4gIH1cbiAgZGVsUnVuU25vdyhpdGVtOmFueSkge1xuICAgIHRoaXMucnVuc1Nub3cgPSB0aGlzLnJ1bnNTbm93LmZpbHRlcigoeDogYW55KSA9PiB4ICE9IGl0ZW0pXG4gIH1cblxuXG4gIGFkZFJ1bkdlb1BvdCgpe1xuICAgIHRoaXMucnVuc0dlb1BvdCA9IFsuLi50aGlzLnJ1bnNHZW9Qb3QsIHtpZDoxLCBydW46Jyd9XVxuICB9XG5cbiAgZGVsUnVuR2VvUG90KGl0ZW06YW55KSB7XG4gICAgdGhpcy5ydW5zR2VvUG90ID1cbiAgICB0aGlzLnJ1bnNHZW9Qb3QuZmlsdGVyKCh4OiBhbnkpID0+IHggIT0gaXRlbSlcbiAgfVxuICBwdWJsaWMgdXBsb2FkZWRJbWFnZUNoYW5nZShldmVudDogYW55KSB7XG4gICAgY29uc29sZS5sb2coZXZlbnQpO1xuICAgIHRoaXMudXBsb2FkZWRJbWFnZUxheWVycz1ldmVudDtcbiAgICB0aGlzLnVwZGF0ZUxheWVycygpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVMYXllcnMoKSB7XG4gICAgdGhpcy5mb3JlY2FzdFJlcG9ydC5sYXllcnM9W107XG4gICAgdGhpcy5ydW5zUHJlYy5mb3JFYWNoKGl0bSA9PiB7aWYgKGl0bS5kYXRhKSAgdGhpcy5mb3JlY2FzdFJlcG9ydC5sYXllcnMucHVzaChpdG0uZGF0YSl9KTtcbiAgICB0aGlzLnJ1bnNTbm93LmZvckVhY2goIGl0bSA9PiB7aWYgKGl0bS5kYXRhKSB0aGlzLmZvcmVjYXN0UmVwb3J0LmxheWVycy5wdXNoKGl0bS5kYXRhKX0pO1xuICAgIHRoaXMucnVuc0dlb1BvdC5mb3JFYWNoKCBpdG0gPT4ge2lmIChpdG0uZGF0YSkgdGhpcy5mb3JlY2FzdFJlcG9ydC5sYXllcnMucHVzaChpdG0uZGF0YSl9KTtcbiAgICB0aGlzLnVwbG9hZGVkSW1hZ2VMYXllcnMuZm9yRWFjaChpdG0gPT4gdGhpcy5mb3JlY2FzdFJlcG9ydC5sYXllcnMucHVzaChpdG0pKTtcbiAgICBjb25zb2xlLmxvZygnbGF5ZXJzJyx0aGlzLmZvcmVjYXN0UmVwb3J0LmxheWVycyk7XG4gIH1cblxuICBkYXRlVXBkYXRlKCkge1xuICAgICAgaWYgKHRoaXMuZGF0ZUZyb20pXG4gICAgICAgIHRoaXMuZm9yZWNhc3RSZXBvcnQuZnJvbVVUQ1NlY29uZD0gTWF0aC50cnVuYyhuZXcgRGF0ZSh0aGlzLmRhdGVGcm9tKS5nZXRUaW1lKCkvMTAwMCk7XG4gICAgICBpZiAodGhpcy5kYXRlVG8pXG4gICAgICAgIHRoaXMuZm9yZWNhc3RSZXBvcnQudG9VVENTZWNvbmQ9IE1hdGgudHJ1bmMobmV3IERhdGUodGhpcy5kYXRlVG8pLmdldFRpbWUoKS8xMDAwKTtcbiAgICAgIC8vdGhpcy5sb2FkU3RhdGlvbnMoKTtcbiAgICAgIHRoaXMubG9hZEZvcmVjYXN0RGF0YXNBdmFpbGFiaWxpdHkoKTtcbiAgICB9XG5cbiAgcHVibGljIGxheW91dENoYW5nZShsYXlvdXQ6IFByaW50TGF5b3V0KSB7XG4gICAgaWYgKHRoaXMuZm9yZWNhc3RSZXBvcnQpXG4gICAgICB0aGlzLmZvcmVjYXN0UmVwb3J0Lm5JbWdzID0gbGF5b3V0Lm51bWJlck9mSW1hZ2VzO1xuICAgICBjb25zb2xlLmxvZygncmVwb3J0Jyx0aGlzLmZvcmVjYXN0UmVwb3J0KTtcbiAgfVxuXG4gIHB1YmxpYyBzZWxlY3RNYXAodHlwZTogc3RyaW5nLGV2ZW50OiBhbnksICBwcmVjOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdzZWxlY3RlZCcsZXZlbnQscHJlYyk7XG5cbiAgICAgIC8vVE9ET1xuICAgICAgdGhpcy5yZXBvcnRlclNlcnZpY2UuZ2V0Rm9yZWNhc3REYXRhKHR5cGUsIGV2ZW50KS5zdWJzY3JpYmUoXG4gICAgICAgIGRhdGEgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgIHByZWMuZGF0YT1kYXRhO1xuICAgICAgICAgIHRoaXMudXBkYXRlTGF5ZXJzKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yID0+e1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgIHRoaXMuc25hY2tCYXIuZXJyb3IoXCJFcnJvcmUgZHVyYW50ZSBpbCBjYXJpY2FtZW50byBkZWxsYSBtYXBwYSBkaSBwcmV2aXNpb25lLlwiLCAnJywge2R1cmF0aW9uOjIwMDB9KTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZEF2YWlsYWJpbGl0eShkYXRhVHlwZTogc3RyaW5nLCBsaXN0RGF0YTogYW55W10pIHtcbiAgICBsaXN0RGF0YS5zcGxpY2UoMCxsaXN0RGF0YS5sZW5ndGgpO1xuICAgIHRoaXMucmVwb3J0ZXJTZXJ2aWNlLmdldEZvcmVjYXN0RGF0YXNBdmFpbGFiaWxpdHkoZGF0YVR5cGUsXG4gICAgICAgIHRoaXMuZm9yZWNhc3RSZXBvcnQuZnJvbVVUQ1NlY29uZCxcbiAgICAgICAgdGhpcy5mb3JlY2FzdFJlcG9ydC50b1VUQ1NlY29uZCkuc3Vic2NyaWJlKFxuICAgICAgICAgIGRhdGEgPT4ge1xuICAgICAgICAgICAgbGlzdERhdGEucHVzaCguLi5kYXRhLnJ1bnMpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB0aGlzLnNuYWNrQmFyLmVycm9yKCdTaSDDqCB2ZXJpZmljYXRvIHVuIGVycm9yZSBkdXJhbnRlIGxhIGxldHR1cmEgZGVpIGRhdGkuJywgJycsIHtkdXJhdGlvbjoyMDAwfSlcbiAgICAgICAgICB9XG4gICAgICAgIClcbiAgfVxuXG4gIHByaXZhdGUgbG9hZEZvcmVjYXN0RGF0YXNBdmFpbGFiaWxpdHkoKXtcbiAgICAvL3RvZG8gY2FuY2VsbGFyZSB2ZWNjaGkgbGF5ZXJzXG4gICAgaWYgKHRoaXMuZm9yZWNhc3RSZXBvcnQuZnJvbVVUQ1NlY29uZD4wICYmIHRoaXMuZm9yZWNhc3RSZXBvcnQudG9VVENTZWNvbmQ+MCl7XG4gICAgICAgIHRoaXMubG9hZEF2YWlsYWJpbGl0eSgnSVRBTElBX1BUJyx0aGlzLnJhaW5NYXBEYXRhcyk7XG4gICAgICAgIHRoaXMubG9hZEF2YWlsYWJpbGl0eSgnSVRBTElBX05UJyx0aGlzLnNub3dNYXBEYXRhcyk7XG4gICAgICAgIHRoaXMubG9hZEF2YWlsYWJpbGl0eSgnRVVSQVRMX0dHVFQnLHRoaXMuZ2VvTWFwRGF0YXMpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBlbmFibGVSZXBvcnQoKSB7XG4gICAgaWYgKHRoaXMuc2VjdGlvbkVuYWJsZWQpe1xuICAgICAgdGhpcy5mb3JlY2FzdFJlcG9ydD17XG4gICAgICAgIGZyb21VVENTZWNvbmQ6IDAsXG4gICAgICAgIHRvVVRDU2Vjb25kOiAwLFxuICAgICAgICB0ZXh0OiAnJyxcbiAgICAgICAgdGl0bGU6ICcnLFxuICAgICAgICBuSW1nczogMSxcbiAgICAgICAgcmFpbmdzX3RpdGxlOiAnUGx1dmlvbWV0cmknLFxuICAgICAgICBoeWRyb3NfdGl0bGU6ICdJZHJvbWV0cmknLFxuICAgICAgICBsYXllcnM6IFtdLCAvL3RvZG9cbiAgICAgIH1cbiAgICAgIHRoaXMudXBkYXRlTGF5ZXJzKCk7XG4gICAgICB0aGlzLmRhdGVVcGRhdGUoKTtcbiAgICAgIHRoaXMuZm9yZWNhc3RSZXBvcnRDaGFuZ2UuZW1pdCh0aGlzLmZvcmVjYXN0UmVwb3J0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5mb3JlY2FzdFJlcG9ydD11bmRlZmluZWQ7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICB0aGlzLmVuYWJsZVJlcG9ydCgpO1xuICB9XG5cblxufVxuIiwiPCEtLWFiaWxpdGF6aW9uZS0tPlxuPG1hdC1zbGlkZS10b2dnbGVcbiAgY2xhc3M9XCJcIlxuICBjb2xvcj1wcmltYXJ5IFsobmdNb2RlbCldPVwic2VjdGlvbkVuYWJsZWRcIiAoY2hhbmdlKT1cImVuYWJsZVJlcG9ydCgpXCI+XG4gIEluY2x1ZGkgU2l0dWF6aW9uZSBQcmV2aXN0YVxuPC9tYXQtc2xpZGUtdG9nZ2xlPlxuXG5cbjxkaXYgY2xhc3M9XCJzZWN0aW9uLXdyYXBwZXJcIiBbbmdDbGFzc109XCIhc2VjdGlvbkVuYWJsZWQ/J3NlY3Rpb24tZGlzYWJsZWQnOicnXCI+XG4gIDwhLS1tYXBwYS0tPlxuICA8ZGl2IGNsYXNzPVwiY29sLTEyIG15LTJcIj5cbiAgICA8IS0tcGVyaW9kbyBkaSBhbmFsaXNpLS0+XG4gICAgPGgyIGNsYXNzPVwiYm9yZGVyLWJvdHRvbSBtYi0zIG10LTNcIj5QZXJpb2RvIGRpIEFuYWxpc2k8L2gyPlxuXG4gICAgPG1hdC1mb3JtLWZpZWxkIGFwcGVhcmFuY2U9XCJmaWxsXCIgY2xhc3M9XCJtZS0yXCI+XG4gICAgICA8bWF0LWxhYmVsPmRhPC9tYXQtbGFiZWw+XG4gICAgICA8aW5wdXQgbWF0SW5wdXQgdHlwZT1cImRhdGV0aW1lLWxvY2FsXCIgcGxhY2Vob2xkZXI9XCJkYXRhIGRhXCIgWyhuZ01vZGVsKV09IFwiZGF0ZUZyb21cIiAoY2hhbmdlKT1cImRhdGVVcGRhdGUoKVwiPlxuICAgIDwvbWF0LWZvcm0tZmllbGQ+XG5cbiAgICA8bWF0LWZvcm0tZmllbGQgYXBwZWFyYW5jZT1cImZpbGxcIiBjbGFzcz1cIm1lLTJcIj5cbiAgICAgIDxtYXQtbGFiZWw+YTwvbWF0LWxhYmVsPlxuICAgICAgPGlucHV0IG1hdElucHV0IHR5cGU9XCJkYXRldGltZS1sb2NhbFwiIHBsYWNlaG9sZGVyPVwiZGF0YSBhXCIgWyhuZ01vZGVsKV09IFwiZGF0ZVRvXCIgKGNoYW5nZSk9XCJkYXRlVXBkYXRlKClcIj5cbiAgICA8L21hdC1mb3JtLWZpZWxkPlxuXG4gICAgPCEtLSA8YnV0dG9uIG1hdC1mbGF0LWJ1dHRvbiBjb2xvcj1cInByaW1hcnlcIj48c3BhbiBjbGFzcz1cImZhcyBmYS1jbG9jayBtZS0xXCI+PC9zcGFuPk5vdzwvYnV0dG9uPiAtLT5cblxuICA8L2Rpdj5cblxuICA8IS0tdGVzdG8gc2l0dWF6aW9uZSBwcmVncmVzc2EtLT5cbiAgPGRpdiBjbGFzcz1cImNvbC0xMiBteS0yXCI+XG4gICAgPGNpbWEtdGV4dC1lZGl0b3IgWyh0ZXh0KV09XCJ0ZXh0RXhwZWN0ZWRcIiBbY29uZmlnXT1cImNvbmZpZ1wiPjwvY2ltYS10ZXh0LWVkaXRvcj5cbiAgPC9kaXY+XG5cbiAgPCEtLWxheW91dCBzdGFtcGEtLT5cbiAgPGRpdiBjbGFzcz1cImNvbC0xMiBteS0yXCI+XG4gICAgPHJlcG9ydGVyLXByaW50LWxheW91dCAgKHNlbGVjdGVkKT1cImxheW91dENoYW5nZSgkZXZlbnQpXCI+PC9yZXBvcnRlci1wcmludC1sYXlvdXQ+XG4gIDwvZGl2PlxuXG4gIDwhLS1sYXllci0tPlxuICA8ZGl2IGNsYXNzPVwiY29sLTEyIG15LTJcIj5cbiAgICA8aDIgY2xhc3M9XCJib3JkZXItYm90dG9tIG1iLTMgbXQtM1wiPkxheWVyczwvaDI+XG4gICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuXG4gICAgICA8IS0tUFJFQ0lQSVRBWklPTkktLT5cbiAgICAgIDxkaXYgY2xhc3M9XCJjb2wtMTIgY29sLWxnLTYgY29sLXhsLTMgbWItMlwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXdyYXBwZXIgcC0zXCI+XG4gICAgICAgICAgPGgzPlByZXZpc2lvbmUgUHJlY2lwaXRhemlvbmUgY3VtLiA2aDwvaDM+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInJ1blByZWNcIiAqbmdGb3I9XCJsZXQgcHJlYyBvZiBydW5zUHJlYywgbGV0IGkgPSBpbmRleFwiPlxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaXRlbS1saXN0LWJpZy1idWxsIGJnLXNlY29uZGFyeVwiPlxuICAgICAgICAgICAgICA8c3Bhbj57e2krMX19PC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxtYXQtZm9ybS1maWVsZCBhcHBlYXJhbmNlPVwiZmlsbFwiIGNsYXNzPVwidy0xMDBcIj5cbiAgICAgICAgICAgICAgPG1hdC1sYWJlbD5TZWxlemlvbmEgcnVuPC9tYXQtbGFiZWw+XG4gICAgICAgICAgICAgIDxtYXQtc2VsZWN0ICh2YWx1ZUNoYW5nZSk9XCJzZWxlY3RNYXAoJ0lUQUxJQV9QVCcsJGV2ZW50LCBwcmVjKVwiPlxuICAgICAgICAgICAgICAgIDxtYXQtb3B0aW9uICpuZ0Zvcj1cImxldCBydW4gb2YgcmFpbk1hcERhdGFzXCIgIFt2YWx1ZV09XCJydW5cIj5cbiAgICAgICAgICAgICAgICAgIHt7cnVuLmRlc2NyfX1cbiAgICAgICAgICAgICAgICA8L21hdC1vcHRpb24+XG4gICAgICAgICAgICAgIDwvbWF0LXNlbGVjdD5cbiAgICAgICAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkZWwtYnRuLXdyYXBwZXIgbXMtMlwiPlxuICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImRlbC1idG4gZmFzIGZhLXRyYXNoLWFsdFwiICpuZ0lmPVwiaT4wXCIgKGNsaWNrKT1cImRlbFJ1blByZWMocHJlYylcIj48L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgPGJ1dHRvbiBtYXQtZmxhdC1idXR0b24gY29sb3I9XCJwcmltYXJ5XCIgY2xhc3M9XCJiZy1zdWNjZXNzXCIgKGNsaWNrKT1cImFkZFJ1blByZWMoKVwiPjxzcGFuIGNsYXNzPVwiZmFzIGZhLXBsdXMgbWUtMVwiPjwvc3Bhbj5BZ2dpdW5naSBSdW4gUHJlY2lwaXRhemlvbmk8L2J1dHRvbj5cblxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8IS0tTkVWRS0tPlxuICAgICAgPGRpdiBjbGFzcz1cImNvbC0xMiBjb2wtbGctNiBjb2wteGwtMyBtYi0yXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtd3JhcHBlciBwLTNcIj5cbiAgICAgICAgICA8aDM+UHJldmlzaW9uZSBOZXZlIGN1bS4gNmg8L2gzPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJydW5QcmVjXCIgKm5nRm9yPVwibGV0IHNub3cgb2YgcnVuc1Nub3csIGxldCBpID0gaW5kZXhcIj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIml0ZW0tbGlzdC1iaWctYnVsbCBiZy1zZWNvbmRhcnlcIj5cbiAgICAgICAgICAgICAgPHNwYW4+e3tpKzF9fTwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICA8bWF0LWZvcm0tZmllbGQgYXBwZWFyYW5jZT1cImZpbGxcIiBjbGFzcz1cInctMTAwXCI+XG4gICAgICAgICAgICAgIDxtYXQtbGFiZWw+U2VsZXppb25hIHJ1bjwvbWF0LWxhYmVsPlxuICAgICAgICAgICAgICA8bWF0LXNlbGVjdCAodmFsdWVDaGFuZ2UpPVwic2VsZWN0TWFwKCdJVEFMSUFfTlQnLCRldmVudCwgc25vdylcIj5cbiAgICAgICAgICAgICAgICA8bWF0LW9wdGlvbiAqbmdGb3I9XCJsZXQgcnVuIG9mIHNub3dNYXBEYXRhc1wiIFt2YWx1ZV09XCJydW5cIj5cbiAgICAgICAgICAgICAgICAgIHt7cnVuLmRlc2NyfX1cbiAgICAgICAgICAgICAgICA8L21hdC1vcHRpb24+XG4gICAgICAgICAgICAgIDwvbWF0LXNlbGVjdD5cbiAgICAgICAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkZWwtYnRuLXdyYXBwZXIgbXMtMlwiPlxuICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImRlbC1idG4gZmFzIGZhLXRyYXNoLWFsdFwiICpuZ0lmPVwiaT4wXCIgKGNsaWNrKT1cImRlbFJ1blNub3coc25vdylcIj48L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgPGJ1dHRvbiBtYXQtZmxhdC1idXR0b24gY29sb3I9XCJwcmltYXJ5XCIgY2xhc3M9XCJiZy1zdWNjZXNzXCIgKGNsaWNrKT1cImFkZFJ1blNub3coKVwiPjxzcGFuIGNsYXNzPVwiZmFzIGZhLXBsdXMgbWUtMVwiPjwvc3Bhbj5BZ2dpdW5naSBSdW4gTmV2ZTwvYnV0dG9uPlxuXG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDwhLS1HRU9QT1RFTlpJQUxJLS0+XG4gICAgICA8ZGl2IGNsYXNzPVwiY29sLTEyIGNvbC1sZy02IGNvbC14bC0zIG1iLTJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC13cmFwcGVyIHAtM1wiPlxuICAgICAgICAgIDxoMz5QcmV2aXNpb25lIEdlb3BvdGVuemlhbGUgY3VtLiA2aCAgKDUwMGhwYSk8L2gzPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJydW5QcmVjXCIgKm5nRm9yPVwibGV0IGdlbyBvZiBydW5zR2VvUG90LCBsZXQgaSA9IGluZGV4XCI+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJpdGVtLWxpc3QtYmlnLWJ1bGwgYmctc2Vjb25kYXJ5XCI+XG4gICAgICAgICAgICAgIDxzcGFuPnt7aSsxfX08L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPG1hdC1mb3JtLWZpZWxkIGFwcGVhcmFuY2U9XCJmaWxsXCIgY2xhc3M9XCJ3LTEwMFwiPlxuICAgICAgICAgICAgICA8bWF0LWxhYmVsPlNlbGV6aW9uYSBydW48L21hdC1sYWJlbD5cbiAgICAgICAgICAgICAgPG1hdC1zZWxlY3QgKHZhbHVlQ2hhbmdlKT1cInNlbGVjdE1hcCgnRVVSQVRMX0dHVFQnLCRldmVudCwgZ2VvKVwiPlxuICAgICAgICAgICAgICAgIDxtYXQtb3B0aW9uICpuZ0Zvcj1cImxldCBydW4gb2YgZ2VvTWFwRGF0YXNcIiBbdmFsdWVdPVwicnVuXCI+XG4gICAgICAgICAgICAgICAgICB7e3J1bi5kZXNjcn19XG4gICAgICAgICAgICAgICAgPC9tYXQtb3B0aW9uPlxuICAgICAgICAgICAgICA8L21hdC1zZWxlY3Q+XG4gICAgICAgICAgICA8L21hdC1mb3JtLWZpZWxkPlxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZGVsLWJ0bi13cmFwcGVyIG1zLTJcIj5cbiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJkZWwtYnRuIGZhcyBmYS10cmFzaC1hbHRcIiAqbmdJZj1cImk+MFwiIChjbGljayk9XCJkZWxSdW5HZW9Qb3QoZ2VvKVwiPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICA8YnV0dG9uIG1hdC1mbGF0LWJ1dHRvbiBjb2xvcj1cInByaW1hcnlcIiBjbGFzcz1cImJnLXN1Y2Nlc3NcIiAoY2xpY2spPVwiYWRkUnVuR2VvUG90KClcIj48c3BhbiBjbGFzcz1cImZhcyBmYS1wbHVzIG1lLTFcIj48L3NwYW4+QWdnaXVuZ2kgUnVuIEdlb3BvdGVuemlhbGU8L2J1dHRvbj5cblxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2IGNsYXNzPVwiY29sLTEyIGNvbC1sZy02IGNvbC14bC0zIG1iLTJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC13cmFwcGVyIHAtM1wiPlxuICAgICAgICAgIDxyZXBvcnRlci1pbWctdXBsb2FkZXIgKHVwbG9hZGVkQ2hhbmdlKT1cInVwbG9hZGVkSW1hZ2VDaGFuZ2UoJGV2ZW50KVwiPjwvcmVwb3J0ZXItaW1nLXVwbG9hZGVyPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuXG48L2Rpdj5cbiJdfQ==